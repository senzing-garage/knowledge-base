# Error messages

## Conventions

1. Error messages are returned in JSON (i.e. a string in JSON format)
1. The JSON will be specified by
   [RFC8927](https://github.com/senzing-garage/go-messaging/blob/main/message-RFC8927.json)
    1. JSON keys are "fixed" (no "dynamic" JSON keys)
    1. Code can be generated to parse error messages in csharp, go, java, python, ruby, rust, typescript.
       See [go-messaging](https://github.com/senzing-garage/go-messaging)
1. JSON keys are
    - **time:** Time of message generation in RFC3339 (Nano) format
    - **level:** Semantically defined [levels](#levels)
    - **id:** A field crafted for unique identification in web searches.
      For more, see [Senzing Component IDs](https://github.com/senzing-garage/knowledge-base/blob/main/lists/senzing-component-ids.md).
    - **description:** The error message generated by the SDK (not the Senzing error message).
      It includes information on where it was called, not just what the error was.
    - **duration:** (Optional) The time taken, in nanoseconds, by the call to the SDK function/method.
    - **location:** The caller's location, not the location in the SDK
    - **type:** The Senzing error class returned
    - **errors:** Zero or more errors from the error "stack".
      Includes the Senzing engine error.
    - **details:** Ad hoc variables that are helpful in error reporting or debugging

## Example log message

1. Example

    ```json
    {
        "time": "2024-02-06T17:02:34.076962445Z",
        "level": "ERROR",
        "id": "senzing-60044037",
        "description": "g2engine.GetEntityByRecordId(DoesntExist, 1070, -1) failed. Reason: DataSource not found",
        "duration": 199045,
        "location": "In MySampleGetEntityFunction() at mysample.go:2129",
        "type": "SzNotFoundError",
        "errors": [
            "0027E|Unknown DATA_SOURCE value 'DOESNTEXIST'"
        ],
        "details": [
            {
                "position": 1,
                "type": "string",
                "value": "DoesntExist"
            },
            {
                "position": 2,
                "type": "string",
                "value": "1070",
                "valueRaw": 1070
            },
            {
                "position": 3,
                "type": "int64",
                "value": "-1",
                "valueRaw": -1
            },
            {
                "position": 4,
                "type": "g2engine._Ctype_longlong",
                "value": "-2",
                "valueRaw": -2
            },
            {
                "position": 5,
                "type": "error",
                "value": "0027E|Unknown DATA_SOURCE value 'DOESNTEXIST'"
            }
        ]
    }
    ```

1. Example implementation in Go [go-logging](https://github.com/senzing-garage/go-logging)

## Levels

| Level     | Use                                                   | Comments                    |
|-----------|-------------------------------------------------------|-----------------------------|
| **TRACE** | Entry/Exit tracing                                    | May contain sensitive data. |
| **DEBUG** | Values seen during processing                         | May contain sensitive data. |
| **INFO**  | Process steps achieved                                |                             |
| **WARN**  | Unexpected situations, but processing was successful  |                             |
| **ERROR** | Unexpected situations, processing was not successful  |                             |
| **FATAL** | The process needs to shutdown                         |                             |
| **PANIC** | The underlying system is at issue                     |                             |

## Error class hierarchy

**Note:** The suffix `Error` is used, not `Exception`.

```console
SzError
├── SzBadInputError
│   ├── SzNotFoundError
│   └── SzUnknownDatasourceError
├── SzConfigurationError
├── SzRetryableError
│   ├── SzDatabaseConnectionLostError
│   └── SzRetryTimeoutExceededError
└── SzUnrecoverableError
    ├── SzDatabaseError
    ├── SzLicenseError
    ├── SzNotInitializedError
    └── SzUnhandledError
```

- Class hierarchy implementations:
  - [Go](https://github.com/senzing-garage/g2-sdk-go/blob/126.dockter.1/g2error/main.go)
  - [Python](https://github.com/senzing-garage/g2-sdk-python-next/blob/main/src/senzing/g2exception.py)

## Log formatter

An idea...

Let's say that the customer doesn't want to see the entire JSON or maybe not any JSON at all.
In the Abstract Factory Pattern, we introduce a SzLogFormatter interface (requiring a `format(input_message)` method).
The class or function is passed into the factory constructor and used by the engine, config, configmgr, etc. when creating a message.

A python user's code would look something like:

```python
class LogFormatter:
    def format(input_message):
        message_dict = json.loads(input_message)
        return message_dict.get("description")


if __name__ == "__main__":
    :
    factory = SzAbstractFactory.getBaseFactory(instance_name, settings, LogFormatter)
    engine = factory.createEngine()
    :
    try:
        engine.add_record(data_source_code, record_id, record_definition)
    except SzError as err:
        print(err)  # Simply prints the non-JSON value of "description"
```

The default LogFormatter would be:

```python
class LogFormatter:
    def format(input_message):
        return input_message
```
