# Basic git operations on the command line

## Clone a Repository

To check-out a repository that you will be committing code to, it is best to clone it.  A repository can be cloned into the current directory with the following command.

```console
git clone git@github.com:Senzing/knowledge-base.git
```

## See Current Status of Cloned Repository

This will list pending changelist as well as added/changed/deleted items

```console
git status
```

## Update Current Branch

```console
git pull
```

## Add an Item to the Pending Changelist

```console
git add <filename>
```

## See the Diff of Pending Changelist

```console
git diff
```

## Commit the Pending Changelist

Note:  You want to make sure your repository is synced to github before commiting your changelist to avoid a merge

```console
git commit
```

This will open a text editor for you to comment the changelist

You should now push this committed change to github so others can pull it

```console
git push
```

## See Local Branches in the Repository

This will show the branches of the repository you have checked out, and which branch is currently active locally

```console
git branch
```

## See All Remote Branches in the Repository

This will show all the remote branches available for checkout
first make sure you local repository is in sync with the origin:

```console
git fetch origin
```

then list branches:

```console
git branch -v -a
```

## Switch branches

```console
git checkout <branch_name>
```

You can also use

```console
git switch <branch_name>
```

## Create a new remote branch

First create the branch locally, then push it to github

```console
git checkout -b <branch_name>
git push origin <branch_name>
git branch --set-upstream-to=origin/<branch_name> <branch_name>
```

## Merge changes in main to current branch

In repositories created after October 2020, the "main" branch is used.

```console
GIT_CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
git checkout main
git pull
git checkout ${GIT_CURRENT_BRANCH}
git merge origin/main
git push
```

## Merge changes in main to current branch

In repositories created before October 2020, the "master" branch is used.
However, they've since been migrated to "main" in May 2022.

```console
GIT_CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
git checkout main
git pull
git checkout ${GIT_CURRENT_BRANCH}
git merge origin/main
git push
```

## Delete a remote branch

first delete it locally

```console
git branch -d <branch_name>
```

then delete it on github

```console
git push origin --delete <branch_name>
```

# Help!  I tried to commit to main, now what?

No problem, we got you.
Make sure you are on the branch to which you have been committing.
`git log` to check how many commits you want to roll back.
undo the commits with git reset HEAD~N where “N” is the number of commits you want to undo.

eg, to undo one commit:

```console
git reset HEAD~1
```

now create your branch, switch to it, and continue on as if that didn't happen.
Do be sure to verify that you're only committing the changes you want with `git status`

# One time configuration for your git command line

## set up globals

Set up your name and email

```console
git config --global user.name "Your Name"
git config --global user.email your_git_email@email.com
```

Prune deleted branches from your local when you pull

```console
git config --global fetch.prune true
```

## Block command line pushes that expose your personal email address

1. [Change the GitHub settings to keep your email address private](https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-personal-account-on-github/managing-email-preferences/blocking-command-line-pushes-that-expose-your-personal-email-address)
2. [Set your email address in Git to the noreply email address generated by GitHub](https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-personal-account-on-github/managing-email-preferences/setting-your-commit-email-address#setting-your-commit-email-address-in-git)
3. Test pushing a commit to valiate settings changes.

## Sign commits locally

Prerequisite: [Install GnuPG](https://github.com/Senzing/knowledge-base/blob/main/WHATIS/gnupg.md)

1. [Generate a new GPG key](https://docs.github.com/en/authentication/managing-commit-signature-verification/generating-a-new-gpg-key)
    - NOTE: [Your GPG key must be associated with a GitHub verified email that matches your committer identity.](https://docs.github.com/en/authentication/troubleshooting-commit-signature-verification/using-a-verified-email-address-in-your-gpg-key)
2. [Configure git to use the key generated in step 1](https://docs.github.com/en/authentication/managing-commit-signature-verification/telling-git-about-your-signing-key)
3. [Add the GPG key to GitHub](https://docs.github.com/en/authentication/managing-commit-signature-verification/adding-a-gpg-key-to-your-github-account)
4. [Push a new commit and validate your commit verification status](https://docs.github.com/en/authentication/troubleshooting-commit-signature-verification/checking-your-commit-and-tag-signature-verification-status#checking-your-commit-signature-verification-status)
5. Optional: Use gpg-agent flags for configuring default caching for authentication or preset passphrase
